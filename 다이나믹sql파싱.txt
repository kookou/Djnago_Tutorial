ğŸ› ï¸ $\text{SQL}$ ê°’ ë¶„ë¦¬ ë° íŒŒì‹± $\text{Java}$ í•¨ìˆ˜ì´ í´ë˜ìŠ¤ëŠ” $\text{SQL}$ ì¿¼ë¦¬ì—ì„œ ë”°ì˜´í‘œë¡œ ê°ì‹¸ì§„ ë¬¸ìì—´ ë¦¬í„°ëŸ´ê³¼ ìˆ«ì ë¦¬í„°ëŸ´ì„ ì°¾ì•„ í”Œë ˆì´ìŠ¤í™€ë”ë¡œ ì¹˜í™˜í•˜ëŠ” ë° ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.1. ê²°ê³¼ ê°ì²´ ì •ì˜ë³€í™˜ëœ $\text{SQL}$ í…œí”Œë¦¿ê³¼ ë§¤ê°œë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ë°˜í™˜í•˜ê¸° ìœ„í•œ ê°„ë‹¨í•œ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.Javaimport java.util.ArrayList;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * íŒŒì‹±ëœ SQL í…œí”Œë¦¿ê³¼ ë§¤ê°œë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ëŠ” DTO (Data Transfer Object)
 */
public class ParsedSqlQuery {
    private final String sqlTemplate;
    private final List<Object> parameters;

    public ParsedSqlQuery(String sqlTemplate, List<Object> parameters) {
        this.sqlTemplate = sqlTemplate;
        this.parameters = parameters;
    }

    public String getSqlTemplate() {
        return sqlTemplate;
    }

    public List<Object> getParameters() {
        return parameters;
    }
}
2. íŒŒì‹± ë¡œì§ êµ¬í˜„ì£¼ìš” íŒŒì‹± ë¡œì§ì„ í¬í•¨í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ì…ë‹ˆë‹¤.Javapublic class DynamicSqlParser {

    // ì •ê·œì‹ íŒ¨í„´: WHERE/SET ì ˆ ë“± ê°’ ë¶€ë¶„ì´ ì˜¬ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ë¥¼ ê°€ì •í•˜ê³ ,
    // ì‘ì€ë”°ì˜´í‘œë¡œ ê°ì‹¸ì§„ ë¬¸ìì—´ ë¦¬í„°ëŸ´('...') ë˜ëŠ” ê³µë°±/ì—°ì‚°ì ë’¤ì— ì˜¤ëŠ” ìˆ«ì ë¦¬í„°ëŸ´(123, -4.5)ì„ ì°¾ìŠµë‹ˆë‹¤.
    // ì£¼ì˜: ì»¬ëŸ¼ëª…ì´ë‚˜ í‚¤ì›Œë“œì™€ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ë³µì¡í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    private static final String VALUE_PATTERN_STRING =
        "\\s(?:=|!=|>=|<=|>|<|LIKE|IN|NOT IN|IS)\\s*('((?:[^'\\\\]|\\\\.)*?)'|([+-]?\\d+(?:\\.\\d+)?))";
    
    private static final Pattern VALUE_PATTERN = Pattern.compile(VALUE_PATTERN_STRING, Pattern.CASE_INSENSITIVE);

    /**
     * ë™ì  SQL ì¿¼ë¦¬ì—ì„œ ê°’ ë¦¬í„°ëŸ´ì„ ì¶”ì¶œí•˜ê³ , ê·¸ ìœ„ì¹˜ë¥¼ JDBC í”Œë ˆì´ìŠ¤í™€ë” (?)ë¡œ ì¹˜í™˜í•©ë‹ˆë‹¤.
     * ì»¬ëŸ¼ëª…/í…Œì´ë¸”ëª…ì€ ì´ í•¨ìˆ˜ê°€ ì•„ë‹Œ, ì™¸ë¶€ì—ì„œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ë¡œ ê²€ì¦ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
     *
     * @param dynamicSql ë™ì ìœ¼ë¡œ ìƒì„±ëœ SQL ì¿¼ë¦¬ ë¬¸ìì—´
     * @return ParsedSqlQuery (SQL í…œí”Œë¦¿ê³¼ ë§¤ê°œë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸)
     */
    public static ParsedSqlQuery parseAndExtractParameters(String dynamicSql) {
        if (dynamicSql == null || dynamicSql.trim().isEmpty()) {
            return new ParsedSqlQuery("", new ArrayList<>());
        }

        List<Object> parameters = new ArrayList<>();
        StringBuilder newSql = new StringBuilder();
        Matcher matcher = VALUE_PATTERN.matcher(dynamicSql);
        int lastEnd = 0;

        while (matcher.find()) {
            // 1. ë§¤ì¹­ë˜ì§€ ì•Šì€ ì´ì „ í…ìŠ¤íŠ¸ë¥¼ ìƒˆë¡œìš´ SQLì— ì¶”ê°€
            newSql.append(dynamicSql, lastEnd, matcher.start());

            // 2. ì—°ì‚°ì ë¶€ë¶„(ì˜ˆ: " = ")ì„ ìƒˆë¡œìš´ SQLì— ì¶”ê°€
            String operatorPart = matcher.group(0).substring(0, matcher.group(0).length() - matcher.group(1).length());
            newSql.append(operatorPart.replaceAll("('((?:[^'\\\\]|\\\\.)*?)'|([+-]?\\d+(?:\\.\\d+)?))", "?"));

            // 3. ê°’ ì¶”ì¶œ ë° ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            String stringValue = matcher.group(2); // ì‘ì€ë”°ì˜´í‘œë¡œ ê°ì‹¸ì§„ ë¬¸ìì—´ (ê·¸ë£¹ 2)
            String numberValue = matcher.group(3); // ìˆ«ì (ê·¸ë£¹ 3)

            if (stringValue != null) {
                // ë”°ì˜´í‘œ ì•ˆì˜ ì‹¤ì œ ë¬¸ìì—´ ê°’ ì¶”ì¶œ (ë”°ì˜´í‘œ ì œê±°)
                parameters.add(stringValue);
            } else if (numberValue != null) {
                // ìˆ«ì ê°’ì€ ì •ìˆ˜ ë˜ëŠ” ì‹¤ìˆ˜ë¡œ íŒŒì‹±
                if (numberValue.contains(".")) {
                    parameters.add(Double.parseDouble(numberValue));
                } else {
                    parameters.add(Long.parseLong(numberValue));
                }
            }

            // 4. ë‹¤ìŒ ê²€ìƒ‰ ì‹œì‘ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            lastEnd = matcher.end();
        }

        // 5. ì¿¼ë¦¬ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ìƒˆë¡œìš´ SQLì— ì¶”ê°€
        newSql.append(dynamicSql.substring(lastEnd));

        return new ParsedSqlQuery(newSql.toString().trim(), parameters);
    }
}
3. ì‚¬ìš© ì˜ˆì‹œ ë° $\text{JDBC}$ ì ìš©ì´ íŒŒì‹± í•¨ìˆ˜ë¡œ ìƒì„±ëœ ê²°ê³¼ë¥¼ $\text{JDBC}$ì˜ $\text{PreparedStatement}$ì— ì–´ë–»ê²Œ ì ìš©í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.Javaimport java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Arrays;

public class SqlExecutionExample {

    // ê°€ìƒì˜ Connection ê°ì²´ë¥¼ ì–»ëŠ” ë©”ì†Œë“œ (ì‹¤ì œ í™˜ê²½ì— ë§ê²Œ êµ¬í˜„ í•„ìš”)
    private static Connection getDummyConnection() {
        // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” DataSource.getConnection() ë“±ì„ ì‚¬ìš©í•´ì•¼ í•¨
        return null; // ì˜ˆì‹œë¥¼ ìœ„í•´ null ë°˜í™˜
    }

    public static void main(String[] args) {
        String dynamicSql = "SELECT user_name FROM users WHERE user_id = 101 AND status = 'Active' AND price > 99.99 AND name LIKE '%í™ê¸¸ë™%'";

        System.out.println("--- 1. ì›ë³¸ ë™ì  SQL ---");
        System.out.println(dynamicSql);

        // 1. íŒŒì‹± í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ë¶„ë¦¬
        ParsedSqlQuery parsed = DynamicSqlParser.parseAndExtractParameters(dynamicSql);

        System.out.println("\n--- 2. ë¶„ë¦¬ëœ ê²°ê³¼ ---");
        System.out.println("SQL í…œí”Œë¦¿: " + parsed.getSqlTemplate());
        System.out.println("ë§¤ê°œë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸: " + parsed.getParameters());

        // 2. JDBC PreparedStatementë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ì‹¤í–‰ (ë³´ì•ˆ ì ìš©)
        try {
            executePreparedQuery(parsed.getSqlTemplate(), parsed.getParameters());
        } catch (SQLException e) {
            System.err.println("SQL ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.getMessage());
        }
    }

    // JDBC ì‹¤í–‰ í•¨ìˆ˜ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Connection ê´€ë¦¬ í•„ìš”)
    public static void executePreparedQuery(String sqlTemplate, List<Object> parameters) throws SQLException {
        // ì‹¤ì œ JDBC ì—°ê²° ê°ì²´ê°€ í•„ìš”í•©ë‹ˆë‹¤.
        // try (Connection conn = getDummyConnection();
        //      PreparedStatement ps = conn.prepareStatement(sqlTemplate)) {
        
        System.out.println("\n--- 3. PreparedStatement ì‹¤í–‰ ì‹œë®¬ë ˆì´ì…˜ ---");
        System.out.println("ë°”ì¸ë”© ì¿¼ë¦¬: " + sqlTemplate);
        
        // ë§¤ê°œë³€ìˆ˜ ë°”ì¸ë”© ì‹œë®¬ë ˆì´ì…˜
        for (int i = 0; i < parameters.size(); i++) {
            Object param = parameters.get(i);
            // ì‹¤ì œ JDBCì—ì„œëŠ” ps.setLong(i + 1, (Long)param), ps.setString(i + 1, (String)param) ë“±ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
            System.out.printf("ì¸ë±ìŠ¤ %dì— ê°’ [%s] (íƒ€ì…: %s) ë°”ì¸ë”©\n", 
                              i + 1, param, param.getClass().getSimpleName());
        }
        
        // try (ResultSet rs = ps.executeQuery()) {
        //     // ê²°ê³¼ ì²˜ë¦¬
        // }
        
        // }
    }
}